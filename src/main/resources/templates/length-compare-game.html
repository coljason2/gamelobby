<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8"/>
    <title>é•·çŸ­æ¯”è¼ƒéŠæˆ²</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 30px;
            background: #f0f4f8;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .question {
            margin: 20px auto;
            max-width: 600px;
            background: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
        }

        .prompt {
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 12px;
        }
        .options {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* å·¦å°é½Š */
            gap: 20px;
            width: 100%;             /* æ’æ»¿çˆ¶å…ƒç´  */
            font-family: monospace;
            font-size: 3rem;
        }

        .option {
            width: 100%;              /* æ’æ»¿çˆ¶å®¹å™¨ */
            text-align: left;         /* æ–‡å­—é å·¦ */
            padding: 8px 15px;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
            user-select: none;
            white-space: nowrap;
        }

        .option:hover {
            border-color: #007bff;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .option.wrong {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .result {
            font-size: 1.5em;
            text-align: center;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        button {
            padding: 10px 30px;
            font-size: 1.2em;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<h1>é•·çŸ­æ¯”è¼ƒéŠæˆ²</h1>
<div id="game-container"></div>
<div class="result" id="final-result"></div>

<script>
    const items = ["ğŸ", "ğŸ§¦", "ğŸ¥¤", "ğŸ§£", "ğŸˆ", "ğŸ«"];

    const totalQuestions = 7;
    let currentQuestion = 0;
    let score = 0;

    // å–å¾— n å€‹ä¸é‡è¤‡éš¨æ©Ÿæ•¸å­—ï¼Œç¯„åœ min ~ maxï¼ˆå«ï¼‰
    function getUniqueRandomNumbers(n, min, max) {
        const set = new Set();
        while (set.size < n) {
            const r = Math.floor(Math.random() * (max - min + 1)) + min;
            set.add(r);
        }
        return [...set];
    }

    function shuffle(arr) {
        return arr.sort(() => Math.random() - 0.5);
    }

    function generateQuestion() {
        // é¸ä¸€å€‹ emoji é¡åˆ¥
        const emoji = items[Math.floor(Math.random() * items.length)];

        // å–å¾—3å€‹ä¸é‡è¤‡é•·åº¦ï¼Œç¯„åœ 1~5 (ä½ å¯ä»¥æ”¹ç¯„åœ)
        const lengths = getUniqueRandomNumbers(3, 1, 10);

        // ä¾ç…§é•·åº¦ç”¢ç”Ÿä¸åŒé•·åº¦çš„ emoji å­—ä¸²
        const options = lengths.map(len => emoji.repeat(len));

        // æ‰“äº‚é †åº
        const shuffledOptions = shuffle(options);

        // éš¨æ©Ÿæ±ºå®šè¦æ‰¾ã€Œæœ€é•·ã€æˆ–ã€Œæœ€çŸ­ã€
        const expected = Math.random() < 0.5 ? 'longest' : 'shortest';

        return {options: shuffledOptions, expected};
    }

    const gameContainer = document.getElementById('game-container');
    const finalResult = document.getElementById('final-result');

    function renderQuestion() {
        if (currentQuestion >= totalQuestions) {
            gameContainer.innerHTML = '';
            finalResult.innerHTML = `
        ç­”å° ${score} / ${totalQuestions} é¡Œ
        <div class="btn-group" style="margin-top: 30px;">
          <button id="restart-btn">é‡æ–°é–‹å§‹</button>
          <button id="lobby-btn">å›åˆ°å¤§å»³</button>
        </div>
      `;

            document.getElementById('restart-btn').addEventListener('click', () => {
                currentQuestion = 0;
                score = 0;
                finalResult.textContent = '';
                renderQuestion();
            });

            document.getElementById('lobby-btn').addEventListener('click', () => {
                window.location.href = '/lobby'; // ä¿®æ”¹æˆä½ çš„å¤§å»³è·¯å¾‘
            });

            return;
        }

        finalResult.textContent = '';
        const {options, expected} = generateQuestion();

        gameContainer.dataset.expected = expected;
        gameContainer.dataset.options = JSON.stringify(options);

        gameContainer.innerHTML = `
      <div class="question">
        <div class="prompt">è«‹é¸å‡º ${expected === 'longest' ? 'æœ€é•·' : 'æœ€çŸ­'} çš„çµ„åˆï¼š</div>
        <div class="options">
          ${options.map((opt, i) => `<div class="option" data-index="${i}">${opt}</div>`).join('')}
        </div>
      </div>
    `;

        document.querySelectorAll('.option').forEach(el => {
            el.addEventListener('click', () => {
                const clickedIndex = parseInt(el.dataset.index, 10);
                const opts = JSON.parse(gameContainer.dataset.options);
                const exp = gameContainer.dataset.expected;

                let correctIndex = 0;
                if (exp === 'longest') {
                    let maxLen = -1;
                    opts.forEach((v, idx) => {
                        if (v.length > maxLen) {
                            maxLen = v.length;
                            correctIndex = idx;
                        }
                    });
                } else {
                    let minLen = 999;
                    opts.forEach((v, idx) => {
                        if (v.length < minLen) {
                            minLen = v.length;
                            correctIndex = idx;
                        }
                    });
                }

                if (clickedIndex === correctIndex) {
                    el.classList.add('correct');
                    score++;
                } else {
                    el.classList.add('wrong');
                    document.querySelector(`.option[data-index="${correctIndex}"]`).classList.add('correct');
                }

                document.querySelectorAll('.option').forEach(o => o.style.pointerEvents = 'none');

                setTimeout(() => {
                    currentQuestion++;
                    renderQuestion();
                }, 1200);
            });
        });
    }

    renderQuestion();
</script>

</body>
</html>
